<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>All Suppliers - Management System</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  padding: 20px;
  padding-bottom: 60px;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  min-height: 100vh;
  overflow-x: hidden;
  transition: background 0.3s ease;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* Night Mode Styles */
body.night-mode {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  color: #e0e0e0;
}

body.night-mode .container {
  color: #e0e0e0;
}

body.night-mode h1 .title-text {
  background: linear-gradient(135deg, #64b5f6 0%, #42a5f5 50%, #64b5f6 100%);
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

body.night-mode .stat-card {
  background: #2c3e50;
  color: #e0e0e0;
  border-left: 4px solid #64b5f6;
  box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}

body.night-mode .stat-label {
  color: #b0bec5;
}

body.night-mode .stat-value {
  color: #64b5f6;
}

body.night-mode input,
body.night-mode select {
  background: #34495e;
  color: #e0e0e0;
  border-color: #64b5f6;
}

body.night-mode input::placeholder {
  color: #95a5a6;
}

body.night-mode .table-wrapper {
  background-color: #2c3e50;
  box-shadow: 0 8px 25px rgba(0,0,0,0.5);
}

body.night-mode table {
  background-color: #2c3e50;
}

body.night-mode th {
  background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
  color: #64b5f6;
}

body.night-mode th:first-child {
  background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%) !important;
}

body.night-mode th.actions-header {
  background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%) !important;
}

body.night-mode tbody tr:nth-child(even) {
  background-color: #34495e;
}

body.night-mode tbody tr:nth-child(odd) {
  background-color: #2c3e50;
}

body.night-mode tbody tr:hover {
  background-color: #3d5a80;
}

body.night-mode td {
  color: #e0e0e0;
  border-color: #455a64;
}

body.night-mode td:first-child {
  background-color: #2c3e50 !important;
  color: #64b5f6;
}

body.night-mode tbody tr:nth-child(even) td:first-child {
  background-color: #34495e !important;
}

body.night-mode tbody tr:nth-child(odd) td:first-child {
  background-color: #2c3e50 !important;
}

body.night-mode tbody tr:hover td:first-child {
  background-color: #3d5a80 !important;
}

body.night-mode .actions-cell {
  background-color: #2c3e50 !important;
}

body.night-mode tbody tr:nth-child(even) .actions-cell {
  background-color: #34495e !important;
}

body.night-mode tbody tr:nth-child(odd) .actions-cell {
  background-color: #2c3e50 !important;
}

body.night-mode tbody tr:hover .actions-cell {
  background-color: #3d5a80 !important;
}

body.night-mode td[contenteditable="true"]:hover {
  background-color: #3d5a80 !important;
}

body.night-mode td[contenteditable="true"]:focus {
  background-color: #455a64 !important;
  outline-color: #64b5f6;
}

body.night-mode .scroll-indicator {
  background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
  color: #64b5f6;
}

body.night-mode .tab-btn {
  background: #34495e;
  color: #e0e0e0;
}

body.night-mode .tab-btn:hover {
  background: #455a64;
}

body.night-mode .tab-btn.active.vendors-tab {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  color: white;
}

body.night-mode .tab-btn.active.hot-vendors-tab {
  background: linear-gradient(135deg, #ff6f00 0%, #d84315 100%);
  color: white;
}

body.night-mode .tab-btn.active.services-tab {
  background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
  color: white;
}

body.night-mode .tab-btn.active.warehouse-tab {
  background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
  color: white;
}

body.night-mode .tab-btn.active.insights-tab {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
}

body.night-mode .search-section {
  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
  border: 1px solid #455a64;
}

.container {
  max-width: 98%;
  margin: 0 auto;
  animation: fadeIn 0.6s ease;
  will-change: opacity, transform;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

h1 {
  margin-bottom: 25px;
  color: #2c3e50;
  font-size: 2.5em;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
  display: flex;
  align-items: center;
  gap: 15px;
  position: relative;
  animation: headerSlideIn 1s ease-out;
}

@keyframes headerSlideIn {
  from {
    opacity: 0;
    transform: translateX(-100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

h1 .emoji-box {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 1.3em;
  animation: float 3s ease-in-out infinite, rotate3d 4s ease-in-out infinite;
  filter: drop-shadow(0 0 20px rgba(52, 152, 219, 0.6));
  transform-style: preserve-3d;
  position: relative;
  will-change: transform;
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px) scale(1);
  }
  50% {
    transform: translateY(-15px) scale(1.1);
  }
}

@keyframes rotate3d {
  0%, 100% {
    transform: rotateY(0deg) rotateX(0deg);
  }
  25% {
    transform: rotateY(20deg) rotateX(10deg);
  }
  50% {
    transform: rotateY(0deg) rotateX(-10deg);
  }
  75% {
    transform: rotateY(-20deg) rotateX(10deg);
  }
}

h1 .title-text {
  background: linear-gradient(135deg, #3498db 0%, #9b59b6 50%, #e74c3c 100%);
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradientShift 3s ease infinite;
  font-weight: 800;
  letter-spacing: 1px;
  position: relative;
  will-change: background-position;
}

@keyframes gradientShift {
  0%, 100% {
    background-position: 0% center;
  }
  50% {
    background-position: 100% center;
  }
}

/* Theme Toggle Button */
.theme-toggle {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 70px;
  height: 35px;
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  border-radius: 50px;
  cursor: pointer;
  z-index: 10001;
  display: flex;
  align-items: center;
  padding: 4px;
  transition: all 0.4s ease;
  box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.theme-toggle:hover {
  box-shadow: 0 6px 25px rgba(52, 152, 219, 0.6);
  transform: scale(1.05);
}

.theme-toggle-slider {
  width: 27px;
  height: 27px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  position: relative;
}

.theme-toggle-slider::before {
  content: '‚òÄÔ∏è';
  position: absolute;
}

body.night-mode .theme-toggle {
  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
  box-shadow: 0 4px 15px rgba(100, 181, 246, 0.4);
}

body.night-mode .theme-toggle-slider {
  transform: translateX(35px);
}

body.night-mode .theme-toggle-slider::before {
  content: 'üåô';
}

/* Tab Navigation */
.tab-navigation {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.tab-btn {
  padding: 15px 30px;
  font-size: 16px;
  font-weight: 600;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  background: #ecf0f1;
  color: #2c3e50;
  display: flex;
  align-items: center;
  gap: 10px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.tab-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.tab-btn.active.vendors-tab {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  color: white;
  box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
}

.tab-btn.active.hot-vendors-tab {
  background: linear-gradient(135deg, #ff6f00 0%, #d84315 100%);
  color: white;
  box-shadow: 0 6px 20px rgba(255, 111, 0, 0.4);
}

.tab-btn.active.services-tab {
  background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
  color: white;
  box-shadow: 0 6px 20px rgba(155, 89, 182, 0.4);
}

.tab-btn.active.warehouse-tab {
  background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
  color: white;
  box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
}

.tab-btn.active.insights-tab {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
  box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
}

.tab-btn .tab-icon {
  font-size: 1.3em;
}

.tab-btn .tab-count {
  background: rgba(255, 255, 255, 0.3);
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 12px;
  min-width: 35px;
  text-align: center;
}

.tab-btn.active .tab-count {
  background: rgba(255, 255, 255, 0.3);
}

/* Fire animation for hot vendors tab */
.tab-btn.hot-vendors-tab .tab-icon {
  animation: fireFlicker 0.15s ease-in-out infinite;
  filter: drop-shadow(0 0 10px rgba(255, 111, 0, 0.6));
}

@keyframes fireFlicker {
  0%, 100% { transform: scaleY(1) scaleX(1); }
  50% { transform: scaleY(1.05) scaleX(0.95); }
}

/* Services tab icon animation */
.tab-btn.services-tab .tab-icon {
  animation: servicesPulse 2s ease-in-out infinite;
  filter: drop-shadow(0 0 8px rgba(155, 89, 182, 0.5));
}

@keyframes servicesPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

/* Warehouse tab icon animation */
.tab-btn.warehouse-tab .tab-icon {
  animation: warehouseBounce 2s ease-in-out infinite;
  filter: drop-shadow(0 0 8px rgba(39, 174, 96, 0.5));
}

@keyframes warehouseBounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-3px); }
}

/* Insights tab icon animation */
.tab-btn.insights-tab .tab-icon {
  animation: insightsPulse 1.5s ease-in-out infinite;
  filter: drop-shadow(0 0 8px rgba(231, 76, 60, 0.5));
}

@keyframes insightsPulse {
  0%, 100% { transform: scale(1) rotate(0deg); }
  25% { transform: scale(1.1) rotate(-5deg); }
  75% { transform: scale(1.1) rotate(5deg); }
}

.header-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 15px;
}

.back-btn {
  padding: 12px 20px;
  font-size: 14px;
  font-weight: 600;
  background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.back-btn:hover {
  background: linear-gradient(135deg, #7f8c8d 0%, #6c7a7b 100%);
  transform: translateX(-5px);
}

.btn {
  padding: 10px 18px;
  font-size: 13px;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.btn-insert {
  background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
  color: white;
}

.btn-save {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  color: white;
}

.btn-delete {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
}

.stats-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 25px;
}

.stat-card {
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  border-left: 4px solid #3498db;
  transition: all 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.stat-card.hot {
  border-left-color: #ff6f00;
}

.stat-label {
  font-size: 14px;
  color: #7f8c8d;
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  color: #3498db;
}

.stat-card.hot .stat-value {
  color: #ff6f00;
}

.stat-card.services {
  border-left-color: #9b59b6;
}

.stat-card.services .stat-value {
  color: #9b59b6;
}

.stat-card.warehouse {
  border-left-color: #27ae60;
}

.stat-card.warehouse .stat-value {
  color: #27ae60;
}

.stat-card.insights {
  border-left-color: #e74c3c;
}

.stat-card.insights .stat-value {
  color: #e74c3c;
}

.search-section {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  margin-bottom: 24px;
  padding: 20px;
  background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  border: 1px solid #e5e7eb;
  transition: all 0.3s ease;
  align-items: flex-start;
}

.search-section .table-download-container {
  margin-left: auto;
  flex-shrink: 0;
}

.search-section input {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans Arabic', 'Arial', sans-serif;
  text-align: start;
  padding: 14px 18px;
  border: 2px solid #d1d5db;
  border-radius: 10px;
  background-color: #ffffff;
  color: #1f2937;
  flex: 1;
  min-width: 200px;
  max-width: 300px;
  font-size: 15px;
  font-weight: 500;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  min-width: 200px;
}

.search-section input:focus {
  outline: none;
  border-color: #3498db;
  box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
  transform: translateY(-1px);
}

.search-section.hot-mode input:focus {
  border-color: #ff6f00;
  box-shadow: 0 0 0 4px rgba(255, 111, 0, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
}

.search-section.services-mode input:focus {
  border-color: #9b59b6;
  box-shadow: 0 0 0 4px rgba(155, 89, 182, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
}

.search-section.warehouse-mode input:focus {
  border-color: #27ae60;
  box-shadow: 0 0 0 4px rgba(39, 174, 96, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
}

.search-section.insights-mode input:focus {
  border-color: #e74c3c;
  box-shadow: 0 0 0 4px rgba(231, 76, 60, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
}

.scroll-indicator {
  text-align: center;
  padding: 10px;
  background: linear-gradient(135deg, #f0f4f8 0%, #e2e8f0 100%);
  border-radius: 8px;
  margin-bottom: 15px;
  font-size: 14px;
  color: #64748b;
}

.table-wrapper {
  overflow: hidden;
  border-radius: 12px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  background: white;
  transition: all 0.3s ease;
}

.table-scroll {
  overflow-x: auto;
  max-height: 70vh;
  overflow-y: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

th {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  color: white;
  padding: 16px 12px;
  text-align: left;
  font-weight: 600;
  position: sticky;
  top: 0;
  z-index: 10;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: background 0.3s ease;
  white-space: nowrap;
}

.hot-mode th {
  background: linear-gradient(135deg, #ff6f00 0%, #d84315 100%);
}

.services-mode th {
  background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
}

.warehouse-mode th {
  background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
}

.insights-mode th {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
}

th:hover {
  filter: brightness(1.1);
}

th.sortable::after {
  content: ' ‚Üï';
  opacity: 0.5;
}

th.sort-asc::after {
  content: ' ‚Üë';
  opacity: 1;
}

th.sort-desc::after {
  content: ' ‚Üì';
  opacity: 1;
}

th.actions-header {
  position: sticky;
  right: 0;
  z-index: 12;
}

td {
  padding: 14px 12px;
  border-bottom: 1px solid #ecf0f1;
  transition: background 0.2s ease;
}

tbody tr:nth-child(even) {
  background-color: #f8fafc;
}

tbody tr:hover {
  background-color: #e3f2fd;
}

.hot-mode tbody tr:hover {
  background-color: #fff3e0;
}

.services-mode tbody tr:hover {
  background-color: #f5eef8;
}

.warehouse-mode tbody tr:hover {
  background-color: #e8f8f5;
}

.insights-mode tbody tr:hover {
  background-color: #fdedec;
}

td:first-child {
  font-weight: 600;
  color: #3498db;
  position: sticky;
  left: 0;
  background: inherit;
  z-index: 5;
}

.hot-mode td:first-child {
  color: #ff6f00;
}

.services-mode td:first-child {
  color: #9b59b6;
}

.warehouse-mode td:first-child {
  color: #27ae60;
}

.insights-mode td:first-child {
  color: #e74c3c;
}

td[contenteditable="true"]:hover {
  background-color: #e8f4fd !important;
  cursor: text;
}

td[contenteditable="true"]:focus {
  background-color: #d4edfc !important;
  outline: 2px solid #3498db;
  outline-offset: -2px;
}

.actions-cell {
  position: sticky;
  right: 0;
  background: inherit;
  z-index: 5;
  white-space: nowrap;
}

.actions-cell .btn {
  margin: 2px;
  padding: 6px 12px;
  font-size: 12px;
}

.new-row {
  background-color: #e8f5e9 !important;
  animation: pulse-green 1s ease-in-out infinite;
}

@keyframes pulse-green {
  0%, 100% { background-color: #e8f5e9; }
  50% { background-color: #c8e6c9; }
}

/* Toast Notifications */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 16px 24px;
  border-radius: 10px;
  color: white;
  font-weight: 500;
  z-index: 10002;
  animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.toast.success {
  background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
}

.toast.error {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
}

@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

/* Scroll to Top Button */
.scroll-to-top {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 50px;
  height: 50px;
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  z-index: 10000;
  box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
  display: flex;
  align-items: center;
  justify-content: center;
}

.scroll-to-top::before {
  content: '‚Üë';
  font-size: 24px;
  color: white;
  font-weight: bold;
}

.scroll-to-top.show {
  opacity: 1;
  visibility: visible;
}

.scroll-to-top:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(52, 152, 219, 0.6);
}

.hot-mode .scroll-to-top {
  background: linear-gradient(135deg, #ff6f00 0%, #d84315 100%);
  box-shadow: 0 4px 15px rgba(255, 111, 0, 0.4);
}

.hot-mode .scroll-to-top:hover {
  box-shadow: 0 8px 25px rgba(255, 111, 0, 0.6);
}

.services-mode .scroll-to-top {
  background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
  box-shadow: 0 4px 15px rgba(155, 89, 182, 0.4);
}

.services-mode .scroll-to-top:hover {
  box-shadow: 0 8px 25px rgba(155, 89, 182, 0.6);
}

.warehouse-mode .scroll-to-top {
  background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
  box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
}

.warehouse-mode .scroll-to-top:hover {
  box-shadow: 0 8px 25px rgba(39, 174, 96, 0.6);
}

.insights-mode .scroll-to-top {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
}

.insights-mode .scroll-to-top:hover {
  box-shadow: 0 8px 25px rgba(231, 76, 60, 0.6);
}

/* Fixed Scrollbar */
.fixed-scrollbar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 16px;
  background: #f1f1f1;
  overflow-x: auto;
  overflow-y: hidden;
  z-index: 9999;
}

.fixed-scrollbar-content {
  height: 1px;
}

/* Tab Content */
.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

/* Loading Spinner */
.loading {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 40px;
}

.loading::after {
  content: '';
  width: 40px;
  height: 40px;
  border: 4px solid #ecf0f1;
  border-top-color: #3498db;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.hot-mode .loading::after {
  border-top-color: #ff6f00;
}

.services-mode .loading::after {
  border-top-color: #9b59b6;
}

.warehouse-mode .loading::after {
  border-top-color: #27ae60;
}

.insights-mode .loading::after {
  border-top-color: #e74c3c;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Vendor Reference Table Styles */
.reference-panel {
  display: none;
  margin-bottom: 25px;
  animation: fadeIn 0.3s ease;
}

.reference-panel.active {
  display: block;
}

.reference-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.reference-title {
  font-size: 18px;
  font-weight: 600;
  color: #1e3a5f;
  display: flex;
  align-items: center;
  gap: 10px;
}

.reference-title-icon {
  font-size: 24px;
}

.reference-toggle-btn {
  padding: 8px 16px;
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.3s ease;
}

.reference-toggle-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
}

.reference-toggle-btn.collapsed {
  background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
}

.reference-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 15px;
  max-height: 400px;
  overflow-y: auto;
  padding: 5px;
}

.reference-card {
  background: white;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
  border: 1px solid #e5e7eb;
  transition: all 0.3s ease;
  cursor: pointer;
}

.reference-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(52, 152, 219, 0.2);
  border-color: #3498db;
}

.reference-card.active {
  border-color: #3498db;
  background: linear-gradient(135deg, #ebf5fb 0%, #d6eaf8 100%);
}

.reference-card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 10px;
}

.reference-card-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  background: linear-gradient(135deg, #ebf5fb 0%, #d6eaf8 100%);
}

.reference-card-title {
  font-size: 15px;
  font-weight: 600;
  color: #1e3a5f;
}

.reference-card-count {
  font-size: 12px;
  color: #7f8c8d;
  background: #f1f5f9;
  padding: 2px 8px;
  border-radius: 10px;
  margin-left: auto;
}

.reference-card-desc {
  font-size: 13px;
  color: #64748b;
  line-height: 1.4;
}

.reference-card-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 10px;
}

.reference-tag {
  font-size: 11px;
  padding: 3px 8px;
  background: #f1f5f9;
  color: #64748b;
  border-radius: 6px;
}

/* Night Mode Reference Table */
body.night-mode .reference-title {
  color: #e0e0e0;
}

body.night-mode .reference-toggle-btn.collapsed {
  background: linear-gradient(135deg, #455a64 0%, #37474f 100%);
}

body.night-mode .reference-card {
  background: #2c3e50;
  border-color: #455a64;
}

body.night-mode .reference-card:hover {
  border-color: #64b5f6;
  box-shadow: 0 6px 20px rgba(100, 181, 246, 0.2);
}

body.night-mode .reference-card.active {
  border-color: #64b5f6;
  background: linear-gradient(135deg, #1a3a4a 0%, #2c3e50 100%);
}

body.night-mode .reference-card-icon {
  background: linear-gradient(135deg, #1a3a4a 0%, #2c4a5a 100%);
}

body.night-mode .reference-card-title {
  color: #e0e0e0;
}

body.night-mode .reference-card-count {
  background: #455a64;
  color: #b0bec5;
}

body.night-mode .reference-card-desc {
  color: #b0bec5;
}

body.night-mode .reference-tag {
  background: #455a64;
  color: #b0bec5;
}

body.night-mode .reference-path {
  background: #34495e;
  color: #b0bec5;
  border-left-color: #ff6f00;
}

/* Insights Panel Styles */
.insights-panel {
  display: none;
  animation: fadeIn 0.3s ease;
}

.insights-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.insights-title {
  font-size: 24px;
  font-weight: 700;
  color: #1e3a5f;
  display: flex;
  align-items: center;
  gap: 10px;
}

.download-pdf-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
}

.download-pdf-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
}

.download-pdf-btn:active {
  transform: translateY(0);
}

.download-pdf-btn.loading {
  opacity: 0.7;
  cursor: not-allowed;
}

.download-pdf-btn .spinner {
  width: 16px;
  height: 16px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  display: none;
}

.download-pdf-btn.loading .spinner {
  display: block;
}

.download-pdf-btn.loading .btn-text {
  display: none;
}

body.night-mode .insights-title {
  color: #e0e0e0;
}

body.night-mode .download-pdf-btn {
  background: linear-gradient(135deg, #c0392b 0%, #96281b 100%);
}

/* Table Download Button Styles */
.table-download-container {
  position: relative;
  display: inline-block;
}

.table-download-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 18px;
  background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 10px rgba(39, 174, 96, 0.3);
}

.table-download-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
}

.table-download-btn.hot {
  background: linear-gradient(135deg, #ff6f00 0%, #e65100 100%);
  box-shadow: 0 3px 10px rgba(255, 111, 0, 0.3);
}

.table-download-btn.hot:hover {
  box-shadow: 0 5px 15px rgba(255, 111, 0, 0.4);
}

.table-download-btn.services {
  background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
  box-shadow: 0 3px 10px rgba(155, 89, 182, 0.3);
}

.table-download-btn.services:hover {
  box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4);
}

.table-download-btn.warehouse {
  background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
  box-shadow: 0 3px 10px rgba(39, 174, 96, 0.3);
}

.download-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 5px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
  border: 1px solid #e5e7eb;
  overflow: hidden;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.2s ease;
  z-index: 1000;
  min-width: 180px;
}

.download-dropdown.show {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.download-option {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  cursor: pointer;
  transition: background 0.2s ease;
  font-size: 14px;
  color: #374151;
}

.download-option:hover {
  background: #f3f4f6;
}

.download-option-icon {
  font-size: 18px;
}

.download-option-text {
  display: flex;
  flex-direction: column;
}

.download-option-title {
  font-weight: 600;
}

.download-option-desc {
  font-size: 11px;
  color: #9ca3af;
}

body.night-mode .download-dropdown {
  background: #2c3e50;
  border-color: #455a64;
}

body.night-mode .download-option {
  color: #e0e0e0;
}

body.night-mode .download-option:hover {
  background: #34495e;
}

body.night-mode .download-option-desc {
  color: #95a5a6;
}

.insights-panel.active {
  display: block;
}

.insights-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 25px;
}

.insight-card {
  background: white;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  border: 1px solid #e5e7eb;
}

.insight-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

.insight-card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}

.insight-card-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
}

.insight-card-icon.vendors { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); }
.insight-card-icon.hot { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); }
.insight-card-icon.services { background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); }
.insight-card-icon.warehouse { background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); }
.insight-card-icon.total { background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); }

.insight-card-title {
  font-size: 14px;
  color: #6b7280;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.insight-card-value {
  font-size: 36px;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 8px;
}

.insight-card-value.vendors { color: #3498db; }
.insight-card-value.hot { color: #ff6f00; }
.insight-card-value.services { color: #9b59b6; }
.insight-card-value.warehouse { color: #27ae60; }
.insight-card-value.total { color: #e74c3c; }

.insight-card-change {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  font-weight: 500;
}

.insight-card-change.positive { color: #10b981; }
.insight-card-change.negative { color: #ef4444; }
.insight-card-change.neutral { color: #6b7280; }

/* Charts Section */
.charts-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
  margin-bottom: 25px;
}

.chart-card {
  background: white;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid #e5e7eb;
}

.chart-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.chart-card-title {
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
}

.chart-container {
  position: relative;
  height: 250px;
}

/* Bar Chart */
.bar-chart {
  display: flex;
  align-items: flex-end;
  justify-content: space-around;
  height: 200px;
  padding: 20px 0;
  gap: 20px;
}

.bar-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  max-width: 80px;
}

.bar {
  width: 100%;
  border-radius: 8px 8px 0 0;
  transition: height 0.5s ease;
  min-height: 10px;
  position: relative;
}

.bar.vendors { background: linear-gradient(180deg, #3498db 0%, #2980b9 100%); }
.bar.hot { background: linear-gradient(180deg, #ff6f00 0%, #d84315 100%); }
.bar.services { background: linear-gradient(180deg, #9b59b6 0%, #8e44ad 100%); }
.bar.warehouse { background: linear-gradient(180deg, #27ae60 0%, #1e8449 100%); }

.bar-label {
  margin-top: 10px;
  font-size: 12px;
  color: #6b7280;
  text-align: center;
  font-weight: 500;
}

.bar-value {
  position: absolute;
  top: -25px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 14px;
  font-weight: 600;
  color: #1f2937;
}

/* Donut Chart */
.donut-chart-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 30px;
}

.donut-chart {
  width: 180px;
  height: 180px;
  border-radius: 50%;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.donut-center {
  position: absolute;
  width: 100px;
  height: 100px;
  background: white;
  border-radius: 50%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.donut-total {
  font-size: 28px;
  font-weight: 700;
  color: #1f2937;
}

.donut-label {
  font-size: 12px;
  color: #6b7280;
}

.donut-legend {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 10px;
}

.legend-color {
  width: 16px;
  height: 16px;
  border-radius: 4px;
}

.legend-color.vendors { background: #3498db; }
.legend-color.hot { background: #ff6f00; }
.legend-color.services { background: #9b59b6; }
.legend-color.warehouse { background: #27ae60; }

.legend-text {
  font-size: 14px;
  color: #4b5563;
}

.legend-value {
  font-weight: 600;
  color: #1f2937;
}

/* Summary Table */
.summary-table-container {
  background: white;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid #e5e7eb;
  overflow-x: auto;
}

.summary-table {
  width: 100%;
  border-collapse: collapse;
}

.summary-table th {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  color: #475569;
  padding: 14px 16px;
  text-align: left;
  font-weight: 600;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 2px solid #e2e8f0;
}

.summary-table td {
  padding: 14px 16px;
  border-bottom: 1px solid #f1f5f9;
  font-size: 14px;
  color: #374151;
}

.summary-table tr:hover td {
  background-color: #f8fafc;
}

.summary-table .category-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
}

.summary-table .category-badge.vendors { background: #e3f2fd; color: #1565c0; }
.summary-table .category-badge.hot { background: #fff3e0; color: #e65100; }
.summary-table .category-badge.services { background: #f3e5f5; color: #7b1fa2; }
.summary-table .category-badge.warehouse { background: #e8f5e9; color: #2e7d32; }

.summary-table .percentage {
  display: flex;
  align-items: center;
  gap: 8px;
}

.percentage-bar {
  width: 100px;
  height: 8px;
  background: #e5e7eb;
  border-radius: 4px;
  overflow: hidden;
}

.percentage-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.5s ease;
}

.percentage-fill.vendors { background: #3498db; }
.percentage-fill.hot { background: #ff6f00; }
.percentage-fill.services { background: #9b59b6; }
.percentage-fill.warehouse { background: #27ae60; }

/* Night Mode Insights */
body.night-mode .insight-card {
  background: #2c3e50;
  border-color: #455a64;
}

body.night-mode .insight-card-title {
  color: #b0bec5;
}

body.night-mode .insight-card-value {
  color: #e0e0e0;
}

body.night-mode .chart-card {
  background: #2c3e50;
  border-color: #455a64;
}

body.night-mode .chart-card-title {
  color: #e0e0e0;
}

body.night-mode .bar-value {
  color: #e0e0e0;
}

body.night-mode .bar-label {
  color: #b0bec5;
}

body.night-mode .donut-center {
  background: #2c3e50;
}

body.night-mode .donut-total {
  color: #e0e0e0;
}

body.night-mode .donut-label {
  color: #b0bec5;
}

body.night-mode .legend-text {
  color: #b0bec5;
}

body.night-mode .legend-value {
  color: #e0e0e0;
}

body.night-mode .summary-table-container {
  background: #2c3e50;
  border-color: #455a64;
}

body.night-mode .summary-table th {
  background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
  color: #b0bec5;
  border-color: #455a64;
}

body.night-mode .summary-table td {
  color: #e0e0e0;
  border-color: #455a64;
}

body.night-mode .summary-table tr:hover td {
  background-color: #34495e;
}

body.night-mode .percentage-bar {
  background: #455a64;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #7f8c8d;
}

.empty-state .empty-icon {
  font-size: 64px;
  margin-bottom: 20px;
}

.empty-state .empty-text {
  font-size: 18px;
  margin-bottom: 10px;
}

/* Category Filter Buttons */
.category-filter {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
  align-items: center;
}

.category-label {
  font-size: 14px;
  font-weight: 600;
  color: #7f8c8d;
  margin-right: 10px;
}

.category-btn {
  padding: 10px 20px;
  font-size: 14px;
  font-weight: 600;
  border: 2px solid #bdc3c7;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  background: white;
  color: #2c3e50;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.category-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
}

.category-btn.active {
  border-color: transparent;
  color: white;
}

.category-btn.all-btn.active {
  background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
  box-shadow: 0 4px 15px rgba(52, 73, 94, 0.4);
}

.category-btn.internal-btn.active {
  background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
  box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
}

.category-btn.external-btn.active {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
}

.category-btn .category-icon {
  font-size: 1.1em;
}

.category-btn .category-count {
  background: rgba(0, 0, 0, 0.1);
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  min-width: 24px;
  text-align: center;
}

.category-btn.active .category-count {
  background: rgba(255, 255, 255, 0.25);
}

/* Night mode category buttons */
body.night-mode .category-btn {
  background: #34495e;
  color: #e0e0e0;
  border-color: #455a64;
}

body.night-mode .category-btn:hover {
  background: #3d5a80;
}

body.night-mode .category-btn.active {
  border-color: transparent;
}

body.night-mode .category-label {
  color: #b0bec5;
}

/* Tab hidden state */
.tab-btn.hidden {
  display: none !important;
}

/* Responsive */
@media (max-width: 768px) {
  h1 {
    font-size: 1.8em;
    flex-wrap: wrap;
  }
  
  .header-section {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .tab-navigation {
    width: 100%;
  }
  
  .tab-btn {
    flex: 1;
    justify-content: center;
    padding: 12px 15px;
    font-size: 14px;
  }
  
  .category-filter {
    width: 100%;
    justify-content: center;
  }
  
  .category-btn {
    flex: 1;
    justify-content: center;
    padding: 8px 12px;
    font-size: 12px;
  }
}
</style>
</head>
<body>
  <!-- Theme Toggle Button -->
  <div class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
    <div class="theme-toggle-slider"></div>
  </div>

  <div class="container">
    <div class="header-section">
      <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Back to Home</button>
      <h1>
        <span class="emoji-box">üì¶üî•</span>
        <span class="title-text">All Suppliers Management</span>
      </h1>
      <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <button class="btn btn-insert" onclick="addBlankRow()">+ Add New Supplier</button>
        <button class="btn" style="background: #e67e22;" onclick="refreshTableData()" title="Refresh data from database">üîÑ Refresh</button>
      </div>
    </div>

    <!-- Category Filter -->
    <div class="category-filter">
      <span class="category-label">Filter by:</span>
      <button class="category-btn all-btn active" onclick="filterCategory('all')" id="allCategoryBtn">
        <span class="category-icon">üìã</span>
        <span>All</span>
        <span class="category-count" id="allCategoryCount">0</span>
      </button>
      <button class="category-btn internal-btn" onclick="filterCategory('internal')" id="internalCategoryBtn">
        <span class="category-icon">üè¢</span>
        <span>Internal</span>
        <span class="category-count" id="internalCategoryCount">0</span>
      </button>
      <button class="category-btn external-btn" onclick="filterCategory('external')" id="externalCategoryBtn">
        <span class="category-icon">üåê</span>
        <span>External</span>
        <span class="category-count" id="externalCategoryCount">0</span>
      </button>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-navigation" id="tabNavigation">
      <button class="tab-btn vendors-tab active" onclick="switchTab('vendors')" id="vendorsTabBtn" data-category="external">
        <span class="tab-icon">üì¶</span>
        <span>Vendors</span>
        <span class="tab-count" id="vendorsCount">0</span>
      </button>
      <button class="tab-btn hot-vendors-tab" onclick="switchTab('hot-vendors')" id="hotVendorsTabBtn" data-category="external">
        <span class="tab-icon">üî•</span>
        <span>Hot Vendors</span>
        <span class="tab-count" id="hotVendorsCount">0</span>
      </button>
      <button class="tab-btn services-tab" onclick="switchTab('services')" id="servicesTabBtn" data-category="external">
        <span class="tab-icon">üõ†Ô∏è</span>
        <span>Services</span>
        <span class="tab-count" id="servicesCount">0</span>
      </button>
      <button class="tab-btn warehouse-tab" onclick="switchTab('warehouse')" id="warehouseTabBtn" data-category="internal">
        <span class="tab-icon">üè≠</span>
        <span>Warehouse Inventory</span>
        <span class="tab-count" id="warehouseCount">0</span>
      </button>
      <button class="tab-btn insights-tab" onclick="switchTab('insights')" id="insightsTabBtn" data-category="insights">
        <span class="tab-icon">üìä</span>
        <span>Suppliers Insights</span>
      </button>
    </div>

    <!-- Stats Container -->
    <div class="stats-container">
      <div class="stat-card" id="totalCard">
        <div class="stat-label">Total Suppliers</div>
        <div class="stat-value" id="totalSuppliers">0</div>
      </div>
      <div class="stat-card" id="filteredCard">
        <div class="stat-label">Filtered Results</div>
        <div class="stat-value" id="filteredSuppliers">0</div>
      </div>
      <div class="stat-card" id="activeCard">
        <div class="stat-label">Active Records</div>
        <div class="stat-value" id="activeRecords">0</div>
      </div>
    </div>

    <!-- Vendor Reference Panel (shown only on vendors tab) -->
    <div class="reference-panel" id="referencePanel">
      <div class="reference-header">
        <div class="reference-title">
          <span class="reference-title-icon">üìã</span>
          <span>General Code - Swimming Pool Database</span>
        </div>
        <button class="reference-toggle-btn" id="referenceToggleBtn" onclick="toggleReferencePanel()">
          <span id="toggleIcon">‚ñº</span>
          <span id="toggleText">Collapse</span>
        </button>
      </div>
      <div class="reference-path" style="font-size: 12px; color: #64748b; margin-bottom: 15px; padding: 8px 12px; background: #f8fafc; border-radius: 8px; border-left: 3px solid #ff6f00;">
        <strong>üìÅ Path:</strong> \\It\externa\2006\General Code\Orange Files\Swimming Pool Data Base<br>
        <strong>üìÑ Document:</strong> General Code &nbsp;|&nbsp; <strong>üìë File Serial No:</strong> 1
      </div>
      <div class="reference-grid" id="referenceGrid">
        <div class="reference-card" onclick="filterByCode('Foreign Manufactures & Contractors')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üè≠</div>
            <div class="reference-card-title">Foreign Manufactures & Contractors</div>
            <div class="reference-card-count">A01-A05</div>
          </div>
          <div class="reference-card-desc">International manufacturers and contracting companies</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Local Suppliers & Contractors')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üèóÔ∏è</div>
            <div class="reference-card-title">Local Suppliers & Contractors</div>
            <div class="reference-card-count">B01-B05</div>
          </div>
          <div class="reference-card-desc">Local suppliers and contracting services</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Middle East')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üåç</div>
            <div class="reference-card-title">Middle East</div>
            <div class="reference-card-count">BME01</div>
          </div>
          <div class="reference-card-desc">Middle East regional suppliers and vendors</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Pumps')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">‚öôÔ∏è</div>
            <div class="reference-card-title">Pumps</div>
            <div class="reference-card-count">C01-C02</div>
          </div>
          <div class="reference-card-desc">Pool pumps and pumping equipment</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Attractions')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üé¢</div>
            <div class="reference-card-title">Attractions</div>
            <div class="reference-card-count">D01-D02</div>
          </div>
          <div class="reference-card-desc">Water attractions and entertainment features</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Chemical Treatment Equipment')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üß™</div>
            <div class="reference-card-title">Chemical Treatment Equipment</div>
            <div class="reference-card-count">E01-E02</div>
          </div>
          <div class="reference-card-desc">Chemical dosing and treatment systems</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Slides')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üõù</div>
            <div class="reference-card-title">Slides</div>
            <div class="reference-card-count">F01</div>
          </div>
          <div class="reference-card-desc">Water slides and slide systems</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Cleaning Equipment')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üßπ</div>
            <div class="reference-card-title">Cleaning Equipment</div>
            <div class="reference-card-count">G01</div>
          </div>
          <div class="reference-card-desc">Pool cleaning tools and equipment</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Chemicals')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üíä</div>
            <div class="reference-card-title">Chemicals</div>
            <div class="reference-card-count">H01-H02</div>
          </div>
          <div class="reference-card-desc">Pool chemicals and water treatment products</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Pre Fabricated Pools & Accessories')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üèä</div>
            <div class="reference-card-title">Pre Fabricated Pools & Accessories</div>
            <div class="reference-card-count">I01-I02</div>
          </div>
          <div class="reference-card-desc">Prefabricated pool systems and accessories</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Tiling')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üî≤</div>
            <div class="reference-card-title">Tiling</div>
            <div class="reference-card-count">J01-J04</div>
          </div>
          <div class="reference-card-desc">Pool tiles, mosaics and tiling materials</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Hydro Massage Pools')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üíÜ</div>
            <div class="reference-card-title">Hydro Massage Pools</div>
            <div class="reference-card-count">K01-K02</div>
          </div>
          <div class="reference-card-desc">Jacuzzis, spas and hydro massage systems</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Heating')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üî•</div>
            <div class="reference-card-title">Heating</div>
            <div class="reference-card-count">L01-L05</div>
          </div>
          <div class="reference-card-desc">Pool heating systems and equipment</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Games')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üéÆ</div>
            <div class="reference-card-title">Games</div>
            <div class="reference-card-count">M01</div>
          </div>
          <div class="reference-card-desc">Pool games and recreational equipment</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Interior & Exterior Decoration')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üé®</div>
            <div class="reference-card-title">Interior & Exterior Decoration</div>
            <div class="reference-card-count">N01</div>
          </div>
          <div class="reference-card-desc">Pool area decoration and design elements</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Aqua Gym and Hydrotherapy')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üèãÔ∏è</div>
            <div class="reference-card-title">Aqua Gym and Hydrotherapy</div>
            <div class="reference-card-count">O01</div>
          </div>
          <div class="reference-card-desc">Aquatic fitness and therapy equipment</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Fountains')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">‚õ≤</div>
            <div class="reference-card-title">Fountains</div>
            <div class="reference-card-count">P01-P04</div>
          </div>
          <div class="reference-card-desc">Decorative fountains and water features</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Sauna Bath')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üßñ</div>
            <div class="reference-card-title">Sauna Bath</div>
            <div class="reference-card-count">Q01-Q04</div>
          </div>
          <div class="reference-card-desc">Sauna and steam bath equipment</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Magazines')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üì∞</div>
            <div class="reference-card-title">Magazines</div>
            <div class="reference-card-count">R01-R04</div>
          </div>
          <div class="reference-card-desc">Industry publications and magazines</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Sealing & Painting Chemicals')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üé®</div>
            <div class="reference-card-title">Sealing & Painting Chemicals</div>
            <div class="reference-card-count">S01-S04</div>
          </div>
          <div class="reference-card-desc">Pool sealing and painting products</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Swimming Pool Cover')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üõ°Ô∏è</div>
            <div class="reference-card-title">Swimming Pool Cover</div>
            <div class="reference-card-count">T01</div>
          </div>
          <div class="reference-card-desc">Pool covers and protection systems</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('White Goods')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üßä</div>
            <div class="reference-card-title">White Goods</div>
            <div class="reference-card-count">U01</div>
          </div>
          <div class="reference-card-desc">White goods and appliances</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Accessories')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üîß</div>
            <div class="reference-card-title">Accessories</div>
            <div class="reference-card-count">V01</div>
          </div>
          <div class="reference-card-desc">Pool accessories and fittings</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Pool Safety System')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üö®</div>
            <div class="reference-card-title">Pool Safety System</div>
            <div class="reference-card-count">W01</div>
          </div>
          <div class="reference-card-desc">Safety equipment and alarm systems</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Solar Heating')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">‚òÄÔ∏è</div>
            <div class="reference-card-title">Solar Heating</div>
            <div class="reference-card-count">X01</div>
          </div>
          <div class="reference-card-desc">Solar pool heating systems</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Electrolysis & Ionizers')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">‚ö°</div>
            <div class="reference-card-title">Electrolysis & Ionizers</div>
            <div class="reference-card-count">Y01</div>
          </div>
          <div class="reference-card-desc">Salt chlorinators and ionization systems</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Above Ground & Inflatable Pools')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üéà</div>
            <div class="reference-card-title">Above Ground & Inflatable Pools</div>
            <div class="reference-card-count">Z01</div>
          </div>
          <div class="reference-card-desc">Above ground and inflatable pool systems</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Pool Lighting')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üí°</div>
            <div class="reference-card-title">Pool Lighting</div>
            <div class="reference-card-count">Z02</div>
          </div>
          <div class="reference-card-desc">Underwater and pool area lighting</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
        <div class="reference-card" onclick="filterByCode('Dehumidifiers & Heating Pumps')">
          <div class="reference-card-header">
            <div class="reference-card-icon" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">üí®</div>
            <div class="reference-card-title">Dehumidifiers & Heating Pumps</div>
            <div class="reference-card-count">Z03</div>
          </div>
          <div class="reference-card-desc">Dehumidification and heat pump systems</div>
          <div class="reference-card-tags">
            <span class="reference-tag" style="background: #ff6f00; color: white;">Orange File</span>
            <span class="reference-tag">Serial: 1</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Insights Panel (shown when insights tab is active) -->
    <div class="insights-panel" id="insightsPanel">
      <!-- Insights Header with Download Button -->
      <div class="insights-header">
        <div class="insights-title">
          <span>üìä</span>
          <span>Suppliers Insights Report</span>
        </div>
        <button class="download-pdf-btn" id="downloadPdfBtn" onclick="downloadInsightsPDF()">
          <span class="spinner"></span>
          <span class="btn-text">üì• Download PDF</span>
        </button>
      </div>
      <!-- Overview Cards -->
      <div class="insights-grid">
        <div class="insight-card">
          <div class="insight-card-header">
            <div class="insight-card-icon total">üìä</div>
            <div class="insight-card-title">Total Suppliers</div>
          </div>
          <div class="insight-card-value total" id="insightTotal">0</div>
          <div class="insight-card-change neutral">
            <span>üìà</span>
            <span>All categories combined</span>
          </div>
        </div>
        <div class="insight-card">
          <div class="insight-card-header">
            <div class="insight-card-icon vendors">üì¶</div>
            <div class="insight-card-title">Vendors</div>
          </div>
          <div class="insight-card-value vendors" id="insightVendors">0</div>
          <div class="insight-card-change neutral" id="insightVendorsPercent">
            <span>‚Äî</span>
            <span>0% of total</span>
          </div>
        </div>
        <div class="insight-card">
          <div class="insight-card-header">
            <div class="insight-card-icon hot">üî•</div>
            <div class="insight-card-title">Hot Vendors</div>
          </div>
          <div class="insight-card-value hot" id="insightHot">0</div>
          <div class="insight-card-change neutral" id="insightHotPercent">
            <span>‚Äî</span>
            <span>0% of total</span>
          </div>
        </div>
        <div class="insight-card">
          <div class="insight-card-header">
            <div class="insight-card-icon services">üõ†Ô∏è</div>
            <div class="insight-card-title">Services</div>
          </div>
          <div class="insight-card-value services" id="insightServices">0</div>
          <div class="insight-card-change neutral" id="insightServicesPercent">
            <span>‚Äî</span>
            <span>0% of total</span>
          </div>
        </div>
        <div class="insight-card">
          <div class="insight-card-header">
            <div class="insight-card-icon warehouse">üè≠</div>
            <div class="insight-card-title">Warehouse Inventory</div>
          </div>
          <div class="insight-card-value warehouse" id="insightWarehouse">0</div>
          <div class="insight-card-change neutral" id="insightWarehousePercent">
            <span>‚Äî</span>
            <span>0% of total</span>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-section">
        <!-- Bar Chart -->
        <div class="chart-card">
          <div class="chart-card-header">
            <div class="chart-card-title">üìä Suppliers Distribution</div>
          </div>
          <div class="chart-container">
            <div class="bar-chart" id="barChart">
              <div class="bar-item">
                <div class="bar vendors" id="barVendors" style="height: 0px;">
                  <span class="bar-value" id="barVendorsValue">0</span>
                </div>
                <div class="bar-label">Vendors</div>
              </div>
              <div class="bar-item">
                <div class="bar hot" id="barHot" style="height: 0px;">
                  <span class="bar-value" id="barHotValue">0</span>
                </div>
                <div class="bar-label">Hot Vendors</div>
              </div>
              <div class="bar-item">
                <div class="bar services" id="barServices" style="height: 0px;">
                  <span class="bar-value" id="barServicesValue">0</span>
                </div>
                <div class="bar-label">Services</div>
              </div>
              <div class="bar-item">
                <div class="bar warehouse" id="barWarehouse" style="height: 0px;">
                  <span class="bar-value" id="barWarehouseValue">0</span>
                </div>
                <div class="bar-label">Warehouse</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Donut Chart -->
        <div class="chart-card">
          <div class="chart-card-header">
            <div class="chart-card-title">üç© Category Breakdown</div>
          </div>
          <div class="chart-container">
            <div class="donut-chart-container">
              <div class="donut-chart" id="donutChart">
                <div class="donut-center">
                  <div class="donut-total" id="donutTotal">0</div>
                  <div class="donut-label">Total</div>
                </div>
              </div>
              <div class="donut-legend">
                <div class="legend-item">
                  <div class="legend-color vendors"></div>
                  <span class="legend-text">Vendors: </span>
                  <span class="legend-value" id="legendVendors">0</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color hot"></div>
                  <span class="legend-text">Hot Vendors: </span>
                  <span class="legend-value" id="legendHot">0</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color services"></div>
                  <span class="legend-text">Services: </span>
                  <span class="legend-value" id="legendServices">0</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color warehouse"></div>
                  <span class="legend-text">Warehouse: </span>
                  <span class="legend-value" id="legendWarehouse">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Table -->
      <div class="summary-table-container">
        <table class="summary-table">
          <thead>
            <tr>
              <th>Category</th>
              <th>Type</th>
              <th>Count</th>
              <th>Percentage</th>
            </tr>
          </thead>
          <tbody id="summaryTableBody">
            <tr>
              <td><span class="category-badge vendors">üì¶ Vendors</span></td>
              <td>External</td>
              <td id="summaryVendors">0</td>
              <td class="percentage">
                <div class="percentage-bar"><div class="percentage-fill vendors" id="percentFillVendors" style="width: 0%;"></div></div>
                <span id="percentVendors">0%</span>
              </td>
            </tr>
            <tr>
              <td><span class="category-badge hot">üî• Hot Vendors</span></td>
              <td>External</td>
              <td id="summaryHot">0</td>
              <td class="percentage">
                <div class="percentage-bar"><div class="percentage-fill hot" id="percentFillHot" style="width: 0%;"></div></div>
                <span id="percentHot">0%</span>
              </td>
            </tr>
            <tr>
              <td><span class="category-badge services">üõ†Ô∏è Services</span></td>
              <td>External</td>
              <td id="summaryServices">0</td>
              <td class="percentage">
                <div class="percentage-bar"><div class="percentage-fill services" id="percentFillServices" style="width: 0%;"></div></div>
                <span id="percentServices">0%</span>
              </td>
            </tr>
            <tr>
              <td><span class="category-badge warehouse">üè≠ Warehouse</span></td>
              <td>Internal</td>
              <td id="summaryWarehouse">0</td>
              <td class="percentage">
                <div class="percentage-bar"><div class="percentage-fill warehouse" id="percentFillWarehouse" style="width: 0%;"></div></div>
                <span id="percentWarehouse">0%</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Search Section -->
    <div class="search-section" id="searchSection">
      <!-- Download Button -->
      <div class="table-download-container" id="downloadContainer">
        <button class="table-download-btn" id="tableDownloadBtn" onclick="toggleDownloadDropdown()">
          <span>üì•</span>
          <span>Download</span>
          <span>‚ñº</span>
        </button>
        <div class="download-dropdown" id="downloadDropdown">
          <div class="download-option" onclick="downloadTableAsCSV()">
            <span class="download-option-icon">üìÑ</span>
            <div class="download-option-text">
              <span class="download-option-title">CSV Format</span>
              <span class="download-option-desc">Comma-separated values</span>
            </div>
          </div>
          <div class="download-option" onclick="downloadTableAsXLSX()">
            <span class="download-option-icon">üìä</span>
            <div class="download-option-text">
              <span class="download-option-title">Excel Format</span>
              <span class="download-option-desc">XLSX spreadsheet</span>
            </div>
          </div>
          <div class="download-option" onclick="downloadTableAsPDF()">
            <span class="download-option-icon">üìï</span>
            <div class="download-option-text">
              <span class="download-option-title">PDF Format</span>
              <span class="download-option-desc">Printable document</span>
            </div>
          </div>
        </div>
      </div>
      <!-- Dynamic search fields will be inserted here -->
    </div>

    <!-- Scroll Indicator -->
    <div class="scroll-indicator">
      Scroll horizontally to view all columns
    </div>

    <!-- Table Wrapper -->
    <div class="table-wrapper" id="tableWrapper">
      <div class="table-scroll" id="tableScroll">
        <table id="resultsTable">
          <thead id="resultsHead"></thead>
          <tbody id="resultsBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Scroll to Top Button -->
  <button class="scroll-to-top" id="scrollToTop" onclick="scrollToTop()"></button>

  <!-- Fixed Scrollbar -->
  <div class="fixed-scrollbar" id="fixedScrollbar">
    <div class="fixed-scrollbar-content" id="fixedScrollbarContent"></div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // Supabase Configuration
    const SUPABASE_URL = "https://wifxcwzyikwseouoxvwb.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndpZnhjd3p5aWt3c2VvdW94dndiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA0MDUzNjIsImV4cCI6MjA1NTk4MTM2Mn0.uf5HOh9CDq12U9CuIMMQEeS42b5eMvyWx3bRhrAcBa4";
    if (!window.supabaseClient) {
      window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    }
    // Only assign supabase if not already declared
    if (typeof supabase === 'undefined') {
      var supabase = window.supabaseClient;
    } else {
      supabase = window.supabaseClient;
    }

    // Table Names (updated to match new keys)
    const VENDORS_TABLE = "global_code_duplicate1";
    const HOT_VENDORS_TABLE = "hot_vendors";
    const SERVICES_TABLE = "services";
    // If you have a warehouse table, keep it, else comment/remove
    const WAREHOUSE_TABLE = "warehouse_inventory";

    // State
    let currentTab = 'vendors';
    let currentCategory = 'all';
    let columns = [];
    let primaryKey = "id";
    let currentData = [];
    let sortColumn = null;
    let sortDirection = 'asc';
    let searchInputs = {};
    let vendorsTotalCount = 0;
    let hotVendorsTotalCount = 0;
    let servicesTotalCount = 0;
    let warehouseTotalCount = 0;

    // DOM Elements
    const resultsHead = document.getElementById("resultsHead");
    const resultsBody = document.getElementById("resultsBody");
    const totalSuppliersEl = document.getElementById("totalSuppliers");
    const filteredSuppliersEl = document.getElementById("filteredSuppliers");
    const activeRecordsEl = document.getElementById("activeRecords");
    const searchSection = document.getElementById("searchSection");
    const tableScroll = document.getElementById("tableScroll");
    const tableWrapper = document.getElementById("tableWrapper");
    const fixedScrollbar = document.getElementById("fixedScrollbar");
    const fixedScrollbarContent = document.getElementById("fixedScrollbarContent");
    const scrollToTopBtn = document.getElementById("scrollToTop");
    const vendorsCountEl = document.getElementById("vendorsCount");
    const hotVendorsCountEl = document.getElementById("hotVendorsCount");
    const servicesCountEl = document.getElementById("servicesCount");
    const warehouseCountEl = document.getElementById("warehouseCount");
    const vendorsTabBtn = document.getElementById("vendorsTabBtn");
    const hotVendorsTabBtn = document.getElementById("hotVendorsTabBtn");
    const servicesTabBtn = document.getElementById("servicesTabBtn");
    const warehouseTabBtn = document.getElementById("warehouseTabBtn");
    const totalCard = document.getElementById("totalCard");
    const filteredCard = document.getElementById("filteredCard");
    const activeCard = document.getElementById("activeCard");
    
    // Insights Tab Button
    const insightsTabBtn = document.getElementById("insightsTabBtn");
    const insightsPanel = document.getElementById("insightsPanel");
    
    // Category DOM Elements
    const allCategoryBtn = document.getElementById("allCategoryBtn");
    const internalCategoryBtn = document.getElementById("internalCategoryBtn");
    const externalCategoryBtn = document.getElementById("externalCategoryBtn");
    const allCategoryCount = document.getElementById("allCategoryCount");
    const internalCategoryCount = document.getElementById("internalCategoryCount");
    const externalCategoryCount = document.getElementById("externalCategoryCount");
    const tabNavigation = document.getElementById("tabNavigation");
    
    // Data table elements
    const scrollIndicator = document.querySelector(".scroll-indicator");
    
    // Reference Panel DOM Elements
    const referencePanel = document.getElementById("referencePanel");
    const referenceGrid = document.getElementById("referenceGrid");
    const referenceToggleBtn = document.getElementById("referenceToggleBtn");
    let referencePanelCollapsed = false;
    let selectedVendorCategory = null;

    // Theme Toggle
    function toggleTheme() {
      document.body.classList.toggle('night-mode');
      localStorage.setItem('nightMode', document.body.classList.contains('night-mode'));
    }

    // Load saved theme preference
    if (localStorage.getItem('nightMode') === 'true') {
      document.body.classList.add('night-mode');
    }

    // Category Filtering
    function filterCategory(category) {
      currentCategory = category;
      
      // Update category button states
      allCategoryBtn.classList.toggle('active', category === 'all');
      internalCategoryBtn.classList.toggle('active', category === 'internal');
      externalCategoryBtn.classList.toggle('active', category === 'external');
      
      // Show/hide tabs based on category (insights tab always visible)
      const allTabs = tabNavigation.querySelectorAll('.tab-btn');
      allTabs.forEach(tab => {
        const tabCategory = tab.dataset.category;
        // Insights tab is always visible
        if (tabCategory === 'insights') {
          tab.classList.remove('hidden');
        } else if (category === 'all') {
          tab.classList.remove('hidden');
        } else if (tabCategory === category) {
          tab.classList.remove('hidden');
        } else {
          tab.classList.add('hidden');
        }
      });
      
      // If current active tab is hidden, switch to first visible tab
      const activeTab = tabNavigation.querySelector('.tab-btn.active');
      if (activeTab && activeTab.classList.contains('hidden')) {
        const firstVisibleTab = tabNavigation.querySelector('.tab-btn:not(.hidden)');
        if (firstVisibleTab) {
          // Determine which tab to switch to based on ID
          const tabId = firstVisibleTab.id;
          if (tabId === 'vendorsTabBtn') switchTab('vendors');
          else if (tabId === 'hotVendorsTabBtn') switchTab('hot-vendors');
          else if (tabId === 'servicesTabBtn') switchTab('services');
          else if (tabId === 'warehouseTabBtn') switchTab('warehouse');
          else if (tabId === 'insightsTabBtn') switchTab('insights');
        }
      }
      
      // Save preference
      localStorage.setItem('supplierCategory', category);
    }
    
    // Update category counts
    function updateCategoryCounts() {
      const internalCount = warehouseTotalCount;
      const externalCount = vendorsTotalCount + hotVendorsTotalCount + servicesTotalCount;
      const allCount = internalCount + externalCount;
      
      allCategoryCount.textContent = allCount;
      internalCategoryCount.textContent = internalCount;
      externalCategoryCount.textContent = externalCount;
    }
    
    // Load saved category preference
    const savedCategory = localStorage.getItem('supplierCategory');
    if (savedCategory) {
      // Will be applied after DOM is ready
      setTimeout(() => filterCategory(savedCategory), 100);
    }

    // Tab Switching
    function switchTab(tab) {
      currentTab = tab;
      columns = [];
      sortColumn = null;
      sortDirection = 'asc';
      searchInputs = {};

      // Update tab buttons
      vendorsTabBtn.classList.toggle('active', tab === 'vendors');
      hotVendorsTabBtn.classList.toggle('active', tab === 'hot-vendors');
      servicesTabBtn.classList.toggle('active', tab === 'services');
      warehouseTabBtn.classList.toggle('active', tab === 'warehouse');
      insightsTabBtn.classList.toggle('active', tab === 'insights');

      // Update visual mode - remove all modes first
      document.body.classList.remove('hot-mode', 'services-mode', 'warehouse-mode', 'insights-mode');
      tableWrapper.classList.remove('hot-mode', 'services-mode', 'warehouse-mode', 'insights-mode');
      searchSection.classList.remove('hot-mode', 'services-mode', 'warehouse-mode', 'insights-mode');

      // Add appropriate mode class
      if (tab === 'hot-vendors') {
        document.body.classList.add('hot-mode');
        tableWrapper.classList.add('hot-mode');
        searchSection.classList.add('hot-mode');
      } else if (tab === 'services') {
        document.body.classList.add('services-mode');
        tableWrapper.classList.add('services-mode');
        searchSection.classList.add('services-mode');
      } else if (tab === 'warehouse') {
        document.body.classList.add('warehouse-mode');
        tableWrapper.classList.add('warehouse-mode');
        searchSection.classList.add('warehouse-mode');
      } else if (tab === 'insights') {
        document.body.classList.add('insights-mode');
        tableWrapper.classList.add('insights-mode');
        searchSection.classList.add('insights-mode');
      }

      // Update stat cards - remove all classes first
      totalCard.classList.remove('hot', 'services', 'warehouse', 'insights');
      filteredCard.classList.remove('hot', 'services', 'warehouse', 'insights');
      activeCard.classList.remove('hot', 'services', 'warehouse', 'insights');

      // Add appropriate stat card class
      if (tab === 'hot-vendors') {
        totalCard.classList.add('hot');
        filteredCard.classList.add('hot');
        activeCard.classList.add('hot');
      } else if (tab === 'services') {
        totalCard.classList.add('services');
        filteredCard.classList.add('services');
        activeCard.classList.add('services');
      } else if (tab === 'warehouse') {
        totalCard.classList.add('warehouse');
        filteredCard.classList.add('warehouse');
        activeCard.classList.add('warehouse');
      } else if (tab === 'insights') {
        totalCard.classList.add('insights');
        filteredCard.classList.add('insights');
        activeCard.classList.add('insights');
      }
      
      // Update download button color based on tab
      const downloadBtn = document.getElementById('tableDownloadBtn');
      if (downloadBtn) {
        downloadBtn.classList.remove('hot', 'services', 'warehouse');
        if (tab === 'hot-vendors') {
          downloadBtn.classList.add('hot');
        } else if (tab === 'services') {
          downloadBtn.classList.add('services');
        } else if (tab === 'warehouse') {
          downloadBtn.classList.add('warehouse');
        }
      }

      // Show/hide insights panel and data table elements
      if (tab === 'insights') {
        insightsPanel.classList.add('active');
        referencePanel.classList.remove('active');
        searchSection.style.display = 'none';
        scrollIndicator.style.display = 'none';
        tableWrapper.style.display = 'none';
        updateInsightsPanel();
      } else {
        insightsPanel.classList.remove('active');
        searchSection.style.display = '';
        scrollIndicator.style.display = '';
        tableWrapper.style.display = '';
      }
      
      // Show/hide reference panel (only for vendors tab)
      if (tab === 'vendors') {
        referencePanel.classList.add('active');
        clearSelectedCategory();
      } else {
        referencePanel.classList.remove('active');
      }

      // Load data for selected tab
      getTotalCount();
      if (tab !== 'insights') {
        searchSuppliers();
      }
    }

    // Download Insights as PDF
    async function downloadInsightsPDF() {
      const btn = document.getElementById('downloadPdfBtn');
      btn.classList.add('loading');
      
      try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const margin = 15;
        let yPos = margin;
        
        // Get current date
        const now = new Date();
        const dateStr = now.toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        // Get totals
        const total = vendorsTotalCount + hotVendorsTotalCount + servicesTotalCount + warehouseTotalCount;
        const vendorsPercent = total > 0 ? ((vendorsTotalCount / total) * 100).toFixed(1) : 0;
        const hotPercent = total > 0 ? ((hotVendorsTotalCount / total) * 100).toFixed(1) : 0;
        const servicesPercent = total > 0 ? ((servicesTotalCount / total) * 100).toFixed(1) : 0;
        const warehousePercent = total > 0 ? ((warehouseTotalCount / total) * 100).toFixed(1) : 0;
        
        // Header
        pdf.setFillColor(30, 58, 95);
        pdf.rect(0, 0, pageWidth, 40, 'F');
        
        pdf.setTextColor(255, 255, 255);
        pdf.setFontSize(24);
        pdf.setFont('helvetica', 'bold');
        pdf.text('Suppliers Insights Report', margin, 22);
        
        pdf.setFontSize(10);
        pdf.setFont('helvetica', 'normal');
        pdf.text(`Generated: ${dateStr}`, margin, 32);
        
        yPos = 55;
        
        // Summary Section
        pdf.setTextColor(30, 58, 95);
        pdf.setFontSize(16);
        pdf.setFont('helvetica', 'bold');
        pdf.text('Executive Summary', margin, yPos);
        yPos += 10;
        
        // Total Box
        pdf.setFillColor(240, 240, 240);
        pdf.roundedRect(margin, yPos, pageWidth - 2 * margin, 25, 3, 3, 'F');
        
        pdf.setFontSize(12);
        pdf.setTextColor(100, 100, 100);
        pdf.text('Total Suppliers', margin + 5, yPos + 10);
        
        pdf.setFontSize(20);
        pdf.setTextColor(30, 58, 95);
        pdf.setFont('helvetica', 'bold');
        pdf.text(total.toString(), margin + 5, yPos + 20);
        
        yPos += 35;
        
        // Category Breakdown Header
        pdf.setFontSize(16);
        pdf.setTextColor(30, 58, 95);
        pdf.text('Category Breakdown', margin, yPos);
        yPos += 10;
        
        // Categories
        const categories = [
          { name: 'Vendors', count: vendorsTotalCount, percent: vendorsPercent, color: [52, 152, 219] },
          { name: 'Hot Vendors', count: hotVendorsTotalCount, percent: hotPercent, color: [255, 111, 0] },
          { name: 'Services', count: servicesTotalCount, percent: servicesPercent, color: [155, 89, 182] },
          { name: 'Warehouse Inventory', count: warehouseTotalCount, percent: warehousePercent, color: [39, 174, 96] }
        ];
        
        categories.forEach((cat, index) => {
          // Category row
          const rowY = yPos + (index * 22);
          
          // Color indicator
          pdf.setFillColor(cat.color[0], cat.color[1], cat.color[2]);
          pdf.roundedRect(margin, rowY, 5, 15, 1, 1, 'F');
          
          // Category name
          pdf.setFontSize(12);
          pdf.setTextColor(60, 60, 60);
          pdf.setFont('helvetica', 'normal');
          pdf.text(cat.name, margin + 10, rowY + 10);
          
          // Count
          pdf.setFont('helvetica', 'bold');
          pdf.text(cat.count.toString(), 100, rowY + 10);
          
          // Percentage bar background
          pdf.setFillColor(230, 230, 230);
          pdf.roundedRect(120, rowY + 3, 50, 8, 2, 2, 'F');
          
          // Percentage bar fill
          const barWidth = (cat.percent / 100) * 50;
          pdf.setFillColor(cat.color[0], cat.color[1], cat.color[2]);
          pdf.roundedRect(120, rowY + 3, barWidth, 8, 2, 2, 'F');
          
          // Percentage text
          pdf.setFont('helvetica', 'normal');
          pdf.text(`${cat.percent}%`, 175, rowY + 10);
        });
        
        yPos += 100;
        
        // Internal vs External Section
        pdf.setFontSize(16);
        pdf.setTextColor(30, 58, 95);
        pdf.setFont('helvetica', 'bold');
        pdf.text('Internal vs External Analysis', margin, yPos);
        yPos += 15;
        
        const internalCount = warehouseTotalCount;
        const externalCount = vendorsTotalCount + hotVendorsTotalCount + servicesTotalCount;
        const internalPercent = total > 0 ? ((internalCount / total) * 100).toFixed(1) : 0;
        const externalPercent = total > 0 ? ((externalCount / total) * 100).toFixed(1) : 0;
        
        // Internal box
        pdf.setFillColor(39, 174, 96);
        pdf.roundedRect(margin, yPos, 80, 30, 3, 3, 'F');
        pdf.setTextColor(255, 255, 255);
        pdf.setFontSize(10);
        pdf.text('INTERNAL (Warehouse)', margin + 5, yPos + 10);
        pdf.setFontSize(16);
        pdf.setFont('helvetica', 'bold');
        pdf.text(`${internalCount} (${internalPercent}%)`, margin + 5, yPos + 23);
        
        // External box
        pdf.setFillColor(52, 152, 219);
        pdf.roundedRect(margin + 90, yPos, 80, 30, 3, 3, 'F');
        pdf.setTextColor(255, 255, 255);
        pdf.setFontSize(10);
        pdf.setFont('helvetica', 'normal');
        pdf.text('EXTERNAL (Vendors/Services)', margin + 95, yPos + 10);
        pdf.setFontSize(16);
        pdf.setFont('helvetica', 'bold');
        pdf.text(`${externalCount} (${externalPercent}%)`, margin + 95, yPos + 23);
        
        yPos += 45;
        
        // Data Table
        pdf.setFontSize(16);
        pdf.setTextColor(30, 58, 95);
        pdf.text('Detailed Summary Table', margin, yPos);
        yPos += 10;
        
        // Table header
        pdf.setFillColor(30, 58, 95);
        pdf.rect(margin, yPos, pageWidth - 2 * margin, 10, 'F');
        pdf.setTextColor(255, 255, 255);
        pdf.setFontSize(10);
        pdf.setFont('helvetica', 'bold');
        pdf.text('Category', margin + 5, yPos + 7);
        pdf.text('Type', 70, yPos + 7);
        pdf.text('Count', 110, yPos + 7);
        pdf.text('Percentage', 145, yPos + 7);
        yPos += 10;
        
        // Table rows
        const tableData = [
          ['Vendors', 'External', vendorsTotalCount.toString(), `${vendorsPercent}%`],
          ['Hot Vendors', 'External', hotVendorsTotalCount.toString(), `${hotPercent}%`],
          ['Services', 'External', servicesTotalCount.toString(), `${servicesPercent}%`],
          ['Warehouse Inventory', 'Internal', warehouseTotalCount.toString(), `${warehousePercent}%`]
        ];
        
        tableData.forEach((row, index) => {
          const rowY = yPos + (index * 10);
          
          // Alternating row colors
          if (index % 2 === 0) {
            pdf.setFillColor(245, 245, 245);
          } else {
            pdf.setFillColor(255, 255, 255);
          }
          pdf.rect(margin, rowY, pageWidth - 2 * margin, 10, 'F');
          
          pdf.setTextColor(60, 60, 60);
          pdf.setFont('helvetica', 'normal');
          pdf.text(row[0], margin + 5, rowY + 7);
          pdf.text(row[1], 70, rowY + 7);
          pdf.text(row[2], 110, rowY + 7);
          pdf.text(row[3], 145, rowY + 7);
        });
        
        // Footer
        pdf.setFillColor(240, 240, 240);
        pdf.rect(0, pageHeight - 15, pageWidth, 15, 'F');
        pdf.setTextColor(100, 100, 100);
        pdf.setFontSize(8);
        pdf.text('All Suppliers Management System - Confidential Report', margin, pageHeight - 6);
        pdf.text(`Page 1 of 1`, pageWidth - margin - 20, pageHeight - 6);
        
        // Save PDF
        pdf.save(`Suppliers_Insights_Report_${now.toISOString().split('T')[0]}.pdf`);
        
      } catch (error) {
        console.error('Error generating PDF:', error);
        alert('Error generating PDF. Please try again.');
      } finally {
        btn.classList.remove('loading');
      }
    }

    // Update Insights Panel with data
    function updateInsightsPanel() {
      const total = vendorsTotalCount + hotVendorsTotalCount + servicesTotalCount + warehouseTotalCount;
      
      // Update overview cards
      document.getElementById('insightTotal').textContent = total;
      document.getElementById('insightVendors').textContent = vendorsTotalCount;
      document.getElementById('insightHot').textContent = hotVendorsTotalCount;
      document.getElementById('insightServices').textContent = servicesTotalCount;
      document.getElementById('insightWarehouse').textContent = warehouseTotalCount;
      
      // Update percentages
      const vendorsPercent = total > 0 ? ((vendorsTotalCount / total) * 100).toFixed(1) : 0;
      const hotPercent = total > 0 ? ((hotVendorsTotalCount / total) * 100).toFixed(1) : 0;
      const servicesPercent = total > 0 ? ((servicesTotalCount / total) * 100).toFixed(1) : 0;
      const warehousePercent = total > 0 ? ((warehouseTotalCount / total) * 100).toFixed(1) : 0;
      
      document.getElementById('insightVendorsPercent').innerHTML = `<span>üìà</span><span>${vendorsPercent}% of total</span>`;
      document.getElementById('insightHotPercent').innerHTML = `<span>üî•</span><span>${hotPercent}% of total</span>`;
      document.getElementById('insightServicesPercent').innerHTML = `<span>üõ†Ô∏è</span><span>${servicesPercent}% of total</span>`;
      document.getElementById('insightWarehousePercent').innerHTML = `<span>üè≠</span><span>${warehousePercent}% of total</span>`;
      
      // Update bar chart
      const maxCount = Math.max(vendorsTotalCount, hotVendorsTotalCount, servicesTotalCount, warehouseTotalCount, 1);
      const maxHeight = 150;
      
      document.getElementById('barVendors').style.height = `${(vendorsTotalCount / maxCount) * maxHeight}px`;
      document.getElementById('barHot').style.height = `${(hotVendorsTotalCount / maxCount) * maxHeight}px`;
      document.getElementById('barServices').style.height = `${(servicesTotalCount / maxCount) * maxHeight}px`;
      document.getElementById('barWarehouse').style.height = `${(warehouseTotalCount / maxCount) * maxHeight}px`;
      
      document.getElementById('barVendorsValue').textContent = vendorsTotalCount;
      document.getElementById('barHotValue').textContent = hotVendorsTotalCount;
      document.getElementById('barServicesValue').textContent = servicesTotalCount;
      document.getElementById('barWarehouseValue').textContent = warehouseTotalCount;
      
      // Update donut chart
      updateDonutChart(vendorsTotalCount, hotVendorsTotalCount, servicesTotalCount, warehouseTotalCount, total);
      
      // Update legend
      document.getElementById('legendVendors').textContent = vendorsTotalCount;
      document.getElementById('legendHot').textContent = hotVendorsTotalCount;
      document.getElementById('legendServices').textContent = servicesTotalCount;
      document.getElementById('legendWarehouse').textContent = warehouseTotalCount;
      document.getElementById('donutTotal').textContent = total;
      
      // Update summary table
      document.getElementById('summaryVendors').textContent = vendorsTotalCount;
      document.getElementById('summaryHot').textContent = hotVendorsTotalCount;
      document.getElementById('summaryServices').textContent = servicesTotalCount;
      document.getElementById('summaryWarehouse').textContent = warehouseTotalCount;
      
      document.getElementById('percentVendors').textContent = `${vendorsPercent}%`;
      document.getElementById('percentHot').textContent = `${hotPercent}%`;
      document.getElementById('percentServices').textContent = `${servicesPercent}%`;
      document.getElementById('percentWarehouse').textContent = `${warehousePercent}%`;
      
      document.getElementById('percentFillVendors').style.width = `${vendorsPercent}%`;
      document.getElementById('percentFillHot').style.width = `${hotPercent}%`;
      document.getElementById('percentFillServices').style.width = `${servicesPercent}%`;
      document.getElementById('percentFillWarehouse').style.width = `${warehousePercent}%`;
      
      // Update stats for insights view
      totalSuppliersEl.textContent = total;
      filteredSuppliersEl.textContent = total;
      activeRecordsEl.textContent = total;
    }
    
    // Update Donut Chart with CSS conic-gradient
    function updateDonutChart(vendors, hot, services, warehouse, total) {
      const donutChart = document.getElementById('donutChart');
      
      if (total === 0) {
        donutChart.style.background = '#e5e7eb';
        return;
      }
      
      const vendorsAngle = (vendors / total) * 360;
      const hotAngle = (hot / total) * 360;
      const servicesAngle = (services / total) * 360;
      const warehouseAngle = (warehouse / total) * 360;
      
      let currentAngle = 0;
      const vendorsEnd = currentAngle + vendorsAngle;
      const hotEnd = vendorsEnd + hotAngle;
      const servicesEnd = hotEnd + servicesAngle;
      const warehouseEnd = servicesEnd + warehouseAngle;
      
      donutChart.style.background = `conic-gradient(
        #3498db ${currentAngle}deg ${vendorsEnd}deg,
        #ff6f00 ${vendorsEnd}deg ${hotEnd}deg,
        #9b59b6 ${hotEnd}deg ${servicesEnd}deg,
        #27ae60 ${servicesEnd}deg ${warehouseEnd}deg
      )`;
    }

    // Toggle Reference Panel collapse/expand
    function toggleReferencePanel() {
      referencePanelCollapsed = !referencePanelCollapsed;
      const toggleIcon = document.getElementById('toggleIcon');
      const toggleText = document.getElementById('toggleText');
      
      if (referencePanelCollapsed) {
        referenceGrid.style.display = 'none';
        toggleIcon.textContent = '‚ñ∂';
        toggleText.textContent = 'Expand';
        referenceToggleBtn.classList.add('collapsed');
      } else {
        referenceGrid.style.display = '';
        toggleIcon.textContent = '‚ñº';
        toggleText.textContent = 'Collapse';
        referenceToggleBtn.classList.remove('collapsed');
      }
    }
    
    // Toggle Download Dropdown
    function toggleDownloadDropdown() {
      const dropdown = document.getElementById('downloadDropdown');
      dropdown.classList.toggle('show');
    }
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const container = document.getElementById('downloadContainer');
      const dropdown = document.getElementById('downloadDropdown');
      if (container && dropdown && !container.contains(e.target)) {
        dropdown.classList.remove('show');
      }
    });
    
    // Download Table as CSV
    function downloadTableAsCSV() {
      if (!currentData || currentData.length === 0) {
        alert('No data to download. Please search for data first.');
        return;
      }
      
      const dropdown = document.getElementById('downloadDropdown');
      dropdown.classList.remove('show');
      
      // Get column headers
      const headers = columns.join(',');
      
      // Build CSV rows
      const rows = currentData.map(row => {
        return columns.map(col => {
          let value = row[col];
          if (value === null || value === undefined) value = '';
          // Escape quotes and wrap in quotes if contains comma, newline, or quote
          value = String(value);
          if (value.includes(',') || value.includes('\n') || value.includes('"')) {
            value = '"' + value.replace(/"/g, '""') + '"';
          }
          return value;
        }).join(',');
      });
      
      // Combine headers and rows
      const csv = [headers, ...rows].join('\n');
      
      // Create and download file
      const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      const tabName = getCurrentTabName();
      const date = new Date().toISOString().split('T')[0];
      link.href = url;
      link.download = `${tabName}_${date}.csv`;
      link.click();
      
      URL.revokeObjectURL(url);
    }
    
    // Download Table as XLSX
    function downloadTableAsXLSX() {
      if (!currentData || currentData.length === 0) {
        alert('No data to download. Please search for data first.');
        return;
      }
      
      const dropdown = document.getElementById('downloadDropdown');
      dropdown.classList.remove('show');
      
      try {
        // Prepare data for Excel
        const excelData = currentData.map(row => {
          const newRow = {};
          columns.forEach(col => {
            newRow[col] = row[col] !== null && row[col] !== undefined ? row[col] : '';
          });
          return newRow;
        });
        
        // Create workbook and worksheet
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.json_to_sheet(excelData, { header: columns });
        
        // Set column widths
        const colWidths = columns.map(col => ({ wch: Math.max(col.length, 15) }));
        ws['!cols'] = colWidths;
        
        // Add worksheet to workbook
        const tabName = getCurrentTabName();
        XLSX.utils.book_append_sheet(wb, ws, tabName);
        
        // Generate and download file
        const date = new Date().toISOString().split('T')[0];
        XLSX.writeFile(wb, `${tabName}_${date}.xlsx`);
        
      } catch (error) {
        console.error('Error generating XLSX:', error);
        alert('Error generating Excel file. Please try again.');
      }
    }
    
    // Get current tab name for file naming
    function getCurrentTabName() {
      switch (currentTab) {
        case 'vendors': return 'Vendors';
        case 'hot-vendors': return 'Hot_Vendors';
        case 'services': return 'Services';
        case 'warehouse': return 'Warehouse_Inventory';
        default: return 'Data';
      }
    }
    
    // Download Table as PDF
    function downloadTableAsPDF() {
      if (!currentData || currentData.length === 0) {
        alert('No data to download. Please search for data first.');
        return;
      }
      
      const dropdown = document.getElementById('downloadDropdown');
      dropdown.classList.remove('show');
      
      try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('l', 'mm', 'a4');
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const margin = 10;
        let yPos = margin;
        
        const now = new Date();
        const dateStr = now.toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric'
        });
        
        const tabName = getCurrentTabName();
        
        const headerColors = {
          'Vendors': [52, 152, 219],
          'Hot_Vendors': [255, 111, 0],
          'Services': [155, 89, 182],
          'Warehouse_Inventory': [39, 174, 96]
        };
        const headerColor = headerColors[tabName] || [52, 152, 219];
        
        pdf.setFillColor(headerColor[0], headerColor[1], headerColor[2]);
        pdf.rect(0, 0, pageWidth, 20, 'F');
        
        pdf.setTextColor(255, 255, 255);
        pdf.setFontSize(16);
        pdf.setFont('helvetica', 'bold');
        pdf.text(tabName.replace(/_/g, ' ') + ' Report', margin, 13);
        
        pdf.setFontSize(10);
        pdf.setFont('helvetica', 'normal');
        pdf.text('Generated: ' + dateStr + ' | Total Records: ' + currentData.length, pageWidth - margin - 80, 13);
        
        yPos = 28;
        
        const displayColumns = columns.filter(function(col) {
          return col.toLowerCase() !== 'id' && col !== 'rating';
        });
        
        const availableWidth = pageWidth - (2 * margin);
        const colWidth = Math.min(availableWidth / displayColumns.length, 45);
        const tableWidth = colWidth * displayColumns.length;
        const startX = margin;
        
        pdf.setFillColor(headerColor[0], headerColor[1], headerColor[2]);
        pdf.rect(startX, yPos, tableWidth, 8, 'F');
        
        pdf.setTextColor(255, 255, 255);
        pdf.setFontSize(8);
        pdf.setFont('helvetica', 'bold');
        
        displayColumns.forEach(function(col, index) {
          var colName = col.replace(/_/g, ' ');
          var truncatedName = colName.length > 12 ? colName.substring(0, 10) + '..' : colName;
          pdf.text(truncatedName, startX + (index * colWidth) + 2, yPos + 5.5);
        });
        
        yPos += 8;
        
        const rowHeight = 7;
        const maxRowsPerPage = Math.floor((pageHeight - yPos - 15) / rowHeight);
        
        currentData.forEach(function(row, rowIndex) {
          if (rowIndex > 0 && rowIndex % maxRowsPerPage === 0) {
            pdf.addPage();
            yPos = margin;
            
            pdf.setFillColor(headerColor[0], headerColor[1], headerColor[2]);
            pdf.rect(startX, yPos, tableWidth, 8, 'F');
            
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(8);
            pdf.setFont('helvetica', 'bold');
            
            displayColumns.forEach(function(col, index) {
              var colName = col.replace(/_/g, ' ');
              var truncatedName = colName.length > 12 ? colName.substring(0, 10) + '..' : colName;
              pdf.text(truncatedName, startX + (index * colWidth) + 2, yPos + 5.5);
            });
            
            yPos += 8;
          }
          
          if (rowIndex % 2 === 0) {
            pdf.setFillColor(245, 245, 245);
          } else {
            pdf.setFillColor(255, 255, 255);
          }
          pdf.rect(startX, yPos, tableWidth, rowHeight, 'F');
          
          pdf.setTextColor(60, 60, 60);
          pdf.setFontSize(7);
          pdf.setFont('helvetica', 'normal');
          
          displayColumns.forEach(function(col, colIndex) {
            var value = row[col];
            if (value === null || value === undefined) value = '';
            value = String(value);
            
            var maxChars = Math.floor(colWidth / 2);
            if (value.length > maxChars) {
              value = value.substring(0, maxChars - 2) + '..';
            }
            
            pdf.text(value, startX + (colIndex * colWidth) + 2, yPos + 5);
          });
          
          yPos += rowHeight;
        });
        
        const totalPages = pdf.internal.getNumberOfPages();
        for (var i = 1; i <= totalPages; i++) {
          pdf.setPage(i);
          pdf.setFillColor(240, 240, 240);
          pdf.rect(0, pageHeight - 10, pageWidth, 10, 'F');
          pdf.setTextColor(100, 100, 100);
          pdf.setFontSize(8);
          pdf.text('All Suppliers Management System', margin, pageHeight - 4);
          pdf.text('Page ' + i + ' of ' + totalPages, pageWidth - margin - 20, pageHeight - 4);
        }
        
        const date = new Date().toISOString().split('T')[0];
        pdf.save(tabName + '_' + date + '.pdf');
        
      } catch (error) {
        console.error('Error generating PDF:', error);
        alert('Error generating PDF. Please try again.');
      }
    }
    
    // Filter vendors by category from reference card - searches in manual name column
    function filterByCode(categoryName) {
      // Clear previous selection
      clearSelectedCategory();
      
      // Mark selected card
      selectedVendorCategory = categoryName;
      const cards = referenceGrid.querySelectorAll('.reference-card');
      cards.forEach(card => {
        const cardCode = card.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
        if (cardCode === categoryName) {
          card.classList.add('active');
        }
      });
      
      // Find the manual name search input and set the value
      applyManualNameFilter(categoryName);
    }
    
    // Clear selected category
    function clearSelectedCategory() {
      selectedVendorCategory = null;
      const cards = referenceGrid.querySelectorAll('.reference-card');
      cards.forEach(card => card.classList.remove('active'));
      
      // Clear the manual name search input if it exists
      const manualNameInput = searchInputs['manual name'] || searchInputs['Manual Name'] || searchInputs['manual_name'];
      if (manualNameInput) {
        manualNameInput.value = '';
      }
    }
    
    // Apply filter by searching in the manual name column
    async function applyManualNameFilter(categoryName) {
      // First ensure columns are loaded
      if (columns.length === 0) {
        const { data: sampleData } = await supabase.from(VENDORS_TABLE).select("*").limit(1);
        if (sampleData && sampleData.length > 0) {
          columns = Object.keys(sampleData[0]).filter(col => col !== 'rating');
          primaryKey = columns.find(col => col === 'id') || columns.find(col => col.toLowerCase() === 'id') || columns[0];
          createSearchInputs();
        }
      }
      
      // Find the manual name column (case-insensitive search)
      const manualNameColumn = columns.find(col => 
        col.toLowerCase() === 'manual name' || 
        col.toLowerCase() === 'manual_name' ||
        col.toLowerCase() === 'manualname'
      );
      
      if (manualNameColumn && searchInputs[manualNameColumn]) {
        // Set the search input value to the category name
        searchInputs[manualNameColumn].value = categoryName;
        // Trigger the search
        searchSuppliers();
      } else {
        // Fallback: search across all columns for the category name
        const { data, error } = await supabase
          .from(VENDORS_TABLE)
          .select("*")
          .limit(1000);
        
        if (error) {
          console.error('Error fetching vendors:', error);
          return;
        }
        
        if (!data) return;
        
        // Filter by category name in any column
        const filteredData = data.filter(row => {
          return Object.values(row).some(value => {
            if (typeof value === 'string') {
              return value.toLowerCase().includes(categoryName.toLowerCase());
            }
            return false;
          });
        });
        
        currentData = filteredData;
        filteredSuppliersEl.textContent = filteredData.length;
        activeRecordsEl.textContent = filteredData.length;
        renderTable();
      }
    }

    // Get current table name
    function getCurrentTableName() {
      switch (currentTab) {
        case 'vendors': return VENDORS_TABLE;
        case 'hot-vendors': return HOT_VENDORS_TABLE;
        case 'services': return SERVICES_TABLE;
        case 'warehouse': return WAREHOUSE_TABLE;
        default: return VENDORS_TABLE;
      }
    }

    // Get current tab icon for empty state
    function getCurrentTabIcon() {
      switch (currentTab) {
        case 'vendors': return 'üì¶';
        case 'hot-vendors': return 'üî•';
        case 'services': return 'üõ†Ô∏è';
        case 'warehouse': return 'üè≠';
        default: return 'üì¶';
      }
    }

    // Scroll synchronization
    tableScroll.addEventListener('scroll', () => {
      fixedScrollbar.scrollLeft = tableScroll.scrollLeft;
    }, { passive: true });

    fixedScrollbar.addEventListener('scroll', () => {
      tableScroll.scrollLeft = fixedScrollbar.scrollLeft;
    }, { passive: true });

    // Show/hide scroll to top button
    let scrollThrottleTimer = null;
    window.addEventListener('scroll', () => {
      if (!scrollThrottleTimer) {
        scrollThrottleTimer = setTimeout(() => {
          if (window.pageYOffset > 300) {
            scrollToTopBtn.classList.add('show');
          } else {
            scrollToTopBtn.classList.remove('show');
          }
          scrollThrottleTimer = null;
        }, 100);
      }
    }, { passive: true });

    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    // Toast Notifications
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Get Total Count for all tables
    async function getTotalCount() {
      // Get vendors count
      const { count: vendorsCount, error: vendorsError } = await supabase
        .from(VENDORS_TABLE)
        .select("*", { count: 'exact', head: true });

      if (!vendorsError && vendorsCount !== null) {
        vendorsTotalCount = vendorsCount;
        vendorsCountEl.textContent = vendorsCount;
      }

      // Get hot vendors count
      const { count: hotCount, error: hotError } = await supabase
        .from(HOT_VENDORS_TABLE)
        .select("*", { count: 'exact', head: true });

      if (!hotError && hotCount !== null) {
        hotVendorsTotalCount = hotCount;
        hotVendorsCountEl.textContent = hotCount;
      } else if (hotError) {
        console.error('Hot vendors count error:', hotError);
      }

      // Get services count
      const { count: servicesCount, error: servicesError } = await supabase
        .from(SERVICES_TABLE)
        .select("*", { count: 'exact', head: true });

      if (!servicesError && servicesCount !== null) {
        servicesTotalCount = servicesCount;
        servicesCountEl.textContent = servicesCount;
        console.log('Services count loaded:', servicesCount);
      } else if (servicesError) {
        console.error('Services count error:', servicesError);
        servicesCountEl.textContent = '!';
      }

      // Get warehouse count
      const { count: warehouseCount, error: warehouseError } = await supabase
        .from(WAREHOUSE_TABLE)
        .select("*", { count: 'exact', head: true });

      if (!warehouseError && warehouseCount !== null) {
        warehouseTotalCount = warehouseCount;
        warehouseCountEl.textContent = warehouseCount;
      } else if (warehouseError) {
        console.error('Warehouse count error:', warehouseError);
      }

      // Update current tab total
      switch (currentTab) {
        case 'vendors':
          totalSuppliersEl.textContent = vendorsTotalCount;
          break;
        case 'hot-vendors':
          totalSuppliersEl.textContent = hotVendorsTotalCount;
          break;
        case 'services':
          totalSuppliersEl.textContent = servicesTotalCount;
          break;
        case 'warehouse':
          totalSuppliersEl.textContent = warehouseTotalCount;
          break;
        case 'insights':
          const total = vendorsTotalCount + hotVendorsTotalCount + servicesTotalCount + warehouseTotalCount;
          totalSuppliersEl.textContent = total;
          break;
      }
      
      // Update category counts
      updateCategoryCounts();
      
      // Update insights panel if on insights tab
      if (currentTab === 'insights') {
        updateInsightsPanel();
      }
    }

    // Sort Data
    function sortData(data, column, direction) {
      return [...data].sort((a, b) => {
        let aVal = a[column];
        let bVal = b[column];

        if (aVal === null || aVal === undefined) aVal = '';
        if (bVal === null || bVal === undefined) bVal = '';

        const aNum = parseFloat(aVal);
        const bNum = parseFloat(bVal);
        if (!isNaN(aNum) && !isNaN(bNum)) {
          aVal = aNum;
          bVal = bNum;
        } else if (typeof aVal === 'string') {
          aVal = aVal.toLowerCase();
          bVal = bVal.toLowerCase();
        }

        if (direction === 'asc') {
          return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
        } else {
          return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
        }
      });
    }

    // Create Search Inputs
    function createSearchInputs() {
      // Remove only the input elements, keep the download container
      const existingInputs = searchSection.querySelectorAll('input');
      existingInputs.forEach(input => input.remove());
      
      // Reset searchInputs object
      searchInputs = {};

      columns.forEach(col => {
        if (col.toLowerCase() === 'id' || col === 'rating') return;

        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = `Search by ${col.replace(/_/g, ' ')}...`;
        input.dataset.column = col;

        searchInputs[col] = input;
        
        // Insert before the download container
        const downloadContainer = document.getElementById('downloadContainer');
        if (downloadContainer) {
          searchSection.insertBefore(input, downloadContainer);
        } else {
          searchSection.appendChild(input);
        }

        input.addEventListener("input", searchSuppliers);
        input.addEventListener("change", searchSuppliers);
      });
    }

    // Search Suppliers
    async function searchSuppliers() {
      const tableName = getCurrentTableName();
      console.log('Loading data from table:', tableName, 'for tab:', currentTab);
      
      let queryBuilder = supabase.from(tableName).select("*");

      // Apply filters from search inputs
      for (const [column, input] of Object.entries(searchInputs)) {
        const value = input.value.trim();
        if (value) {
          queryBuilder = queryBuilder.ilike(column, `%${value}%`);
        }
      }

      const { data, error } = await queryBuilder.limit(1000);

      if (error) {
        console.error('Error loading data from', tableName, ':', error);
        resultsBody.innerHTML = `<tr><td colspan="100%">Error loading ${currentTab}: ${error.message}</td></tr>`;
        filteredSuppliersEl.textContent = "0";
        return;
      }

      console.log('Data loaded from', tableName, ':', data ? data.length : 0, 'records');

      if (!data || data.length === 0) {
        // If no columns detected yet, try to fetch one record to get columns
        if (columns.length === 0) {
          const { data: sampleData, error: sampleError } = await supabase.from(tableName).select("*").limit(1);
          if (sampleError) {
            console.error('Error fetching sample data:', sampleError);
          }
          if (sampleData && sampleData.length > 0) {
            columns = Object.keys(sampleData[0]).filter(col => col !== 'rating');
            primaryKey = columns.find(col => col === 'id') || columns.find(col => col.toLowerCase() === 'id') || columns[0];
            createSearchInputs();
          }
        }

        // Check if there are any search filters applied
        const hasFilters = Object.values(searchInputs).some(input => input.value.trim() !== '');
        
        resultsHead.innerHTML = "";
        resultsBody.innerHTML = `
          <tr>
            <td colspan="100%">
              <div class="empty-state">
                <div class="empty-icon">${getCurrentTabIcon()}</div>
                <div class="empty-text">${hasFilters ? 'No results found' : 'No data in ' + currentTab}</div>
                <div>${hasFilters ? 'Try adjusting your search criteria' : 'Click the + button above to add your first record'}</div>
              </div>
            </td>
          </tr>`;
        filteredSuppliersEl.textContent = "0";
        activeRecordsEl.textContent = "0";
        return;
      }

      // Detect columns from first result
      if (columns.length === 0) {
        columns = Object.keys(data[0]).filter(col => col !== 'rating');
        primaryKey = columns.find(col => col === 'id') || columns.find(col => col.toLowerCase() === 'id') || columns[0];
        createSearchInputs();
      }

      currentData = data;
      filteredSuppliersEl.textContent = data.length;
      activeRecordsEl.textContent = data.length;

      if (sortColumn) {
        currentData = sortData(currentData, sortColumn, sortDirection);
      }

      renderTable();
      syncScrollbars();
    }

    // Render Table
    function renderTable() {
      resultsHead.innerHTML = "";
      resultsBody.innerHTML = "";

      const headerRow = document.createElement("tr");
      columns.forEach(col => {
        const th = document.createElement("th");
        th.textContent = col.replace(/_/g, ' ').toUpperCase();
        th.className = 'sortable';
        if (col === sortColumn) {
          th.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
        }
        th.onclick = () => handleSort(col);
        headerRow.appendChild(th);
      });
      const actionTh = document.createElement("th");
      actionTh.textContent = "ACTIONS";
      actionTh.className = "actions-header";
      headerRow.appendChild(actionTh);
      resultsHead.appendChild(headerRow);

      currentData.forEach(row => {
        const tr = document.createElement("tr");
        tr.dataset.pk = row[primaryKey];

        columns.forEach(col => {
          const td = document.createElement("td");
          td.textContent = row[col] ?? "";
          td.contentEditable = (col.toLowerCase() !== 'id' && col !== 'created_at');
          td.dataset.column = col;
          tr.appendChild(td);
        });

        const actionTd = document.createElement("td");
        actionTd.className = "actions-cell";

        const saveBtn = document.createElement("button");
        saveBtn.textContent = "üíæ Save";
        saveBtn.className = "btn btn-save";
        saveBtn.onclick = () => updateSupplier(tr);

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "üóë Delete";
        deleteBtn.className = "btn btn-delete";
        deleteBtn.onclick = () => deleteSupplier(tr.dataset.pk);

        actionTd.appendChild(saveBtn);
        actionTd.appendChild(deleteBtn);
        tr.appendChild(actionTd);

        resultsBody.appendChild(tr);
      });
    }

    // Handle Sort
    function handleSort(column) {
      if (sortColumn === column) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        sortColumn = column;
        sortDirection = 'asc';
      }
      currentData = sortData(currentData, sortColumn, sortDirection);
      renderTable();
    }

    // Add Blank Row
    function addBlankRow() {
      const tr = document.createElement("tr");
      tr.className = "new-row";

      columns.forEach(col => {
        const td = document.createElement("td");
        td.contentEditable = (col.toLowerCase() !== 'id' && col !== 'created_at');
        td.dataset.column = col;
        if (col.toLowerCase() === 'id') td.textContent = "AUTO";
        tr.appendChild(td);
      });

      const actionTd = document.createElement("td");
      actionTd.className = "actions-cell";

      const saveBtn = document.createElement("button");
      saveBtn.textContent = "üíæ Save";
      saveBtn.className = "btn btn-save";
      saveBtn.onclick = async () => {
        const tableName = getCurrentTableName();
        const newSupplier = {};
        tr.querySelectorAll("td").forEach(td => {
          if(td.dataset.column && td.dataset.column.toLowerCase() !== 'id' && td.dataset.column !== 'created_at') {
            newSupplier[td.dataset.column] = td.textContent.trim() || null;
          }
        });

        const { error } = await supabase.from(tableName).insert([newSupplier]);
        if(error) {
          showToast("Insert failed: " + error.message, 'error');
          return;
        }
        showToast("Supplier added successfully!", 'success');
        await getTotalCount();
        searchSuppliers();
      };

      const cancelBtn = document.createElement("button");
      cancelBtn.textContent = "‚úñ Cancel";
      cancelBtn.className = "btn btn-delete";
      cancelBtn.onclick = () => tr.remove();

      actionTd.appendChild(saveBtn);
      actionTd.appendChild(cancelBtn);
      tr.appendChild(actionTd);

      resultsBody.prepend(tr);
      tr.querySelector('td[contenteditable="true"]').focus();
    }

    // Update Supplier
    async function updateSupplier(tr) {
      const tableName = getCurrentTableName();
      const updatedData = {};
      tr.querySelectorAll("td[contenteditable]").forEach(td => {
        if(td.dataset.column && td.dataset.column.toLowerCase() !== 'id' && td.dataset.column !== 'created_at') {
          let value = td.textContent.trim();
          updatedData[td.dataset.column] = value || null;
        }
      });

      const { error } = await supabase.from(tableName).update(updatedData).eq(primaryKey, tr.dataset.pk);
      if(error) {
        showToast("Update failed: " + error.message, 'error');
        return;
      }
      showToast("Supplier updated successfully!", 'success');
      searchSuppliers();
    }

    // Delete Supplier
    async function deleteSupplier(pkValue) {
      if(!confirm("Are you sure you want to delete this supplier?")) return;

      const tableName = getCurrentTableName();
      const { error } = await supabase.from(tableName).delete().eq(primaryKey, pkValue);
      if(error) {
        showToast("Delete failed: " + error.message, 'error');
        return;
      }
      showToast("Supplier deleted successfully!", 'success');
      await getTotalCount();
      searchSuppliers();
    }

    // Refresh Table Data
    async function refreshTableData() {
      showToast("Refreshing data...", 'success');
      await getTotalCount();
      await searchSuppliers();
    }

    // Sync Scrollbars
    function syncScrollbars() {
      const table = document.getElementById('resultsTable');
      if (table && tableScroll) {
        const tableWidth = table.scrollWidth;
        fixedScrollbarContent.style.width = tableWidth + 'px';

        const rect = tableWrapper.getBoundingClientRect();
        fixedScrollbar.style.width = rect.width + 'px';
        fixedScrollbar.style.left = rect.left + 'px';
      }
    }

    // Update scrollbar on resize
    window.addEventListener('resize', syncScrollbars);
    window.addEventListener('scroll', function() {
      if (tableWrapper) {
        const rect = tableWrapper.getBoundingClientRect();
        fixedScrollbar.style.left = rect.left + 'px';
      }
    });

    // Initialize
    getTotalCount();
    searchSuppliers();
  </script>
</body>
</html>
